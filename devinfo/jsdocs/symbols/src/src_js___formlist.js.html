<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Source - src/js/__formlist.js</title>
	<meta name="generator" content="JsDoc Toolkit" />

	<link media="all" rel="stylesheet" href="../../css/common.css" type="text/css" />
	<link media="all" rel="stylesheet" href="../../css/bootstrap.min.css" type="text/css" />
	<link media="all" rel="stylesheet" href="../../css/prettify.css" type="text/css" />
	<link media="print" rel="stylesheet" href="../../css/print.css" type="text/css" />
	<style type="text/css">
		.icon-jsdoc {
			background: url("../../img/classicons.png") no-repeat;
		}
	</style>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
	<script src="../../js/prettify.js" type="text/javascript"></script>
	<script src="../../js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body><div class="container-fluid">
<!-- ============================== header ================================= -->
	<!-- begin static/header.html -->
	<header class="header navbar navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container-fluid">
				<a class="brand" href="#"><strong>JsDoc</strong> Reference</a>
				<ul id="class-file-selector" class="nav">
					<li><a href="../../index.html">Class Index</a></li>
					<li><a href="../../files.html">File Index</a></li>
				</ul>
			</div>
		</div>
	</header>
	<!-- end static/header.html -->

<!-- ============================== classes index ============================ -->
	<div class="row-fluid">
		<div id="index" class="span3">
			<!-- begin publish.classesIndex -->
			<div class="well" id="class-list">
	<ul class="nav nav-list">
		<li class="nav-header">Classes</li>
		
			<li><a href="../../symbols/Cache.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Cache</span></span></a></li>
		
			<li><a href="../../symbols/Connection.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Connection</span></span></a></li>
		
			<li><a href="../../symbols/Date.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-namespace"></i><span class="jsdoc-class-index">Date</span></span></a></li>
		
			<li><a href="../../symbols/Form.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Form</span></span></a></li>
		
			<li><a href="../../symbols/Form-DataXML.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">DataXML</span></span> <span class="pull-right label label-jsdoc label-jsdoc-inner">Inner</span> </a></li>
		
			<li><a href="../../symbols/Form-DataXML-Nodeset.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Nodeset</span></span> <span class="pull-right label label-jsdoc label-jsdoc-inner">Inner</span> </a></li>
		
			<li><a href="../../symbols/Form-FormHTML.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">FormHTML</span></span> <span class="pull-right label label-jsdoc label-jsdoc-inner">Inner</span> </a></li>
		
			<li><a href="../../symbols/FormHTML%23Branch.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Branch</span></span></a></li>
		
			<li><a href="../../symbols/GUI.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">GUI</span></span></a></li>
		
			<li><a href="../../symbols/Print.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Print</span></span></a></li>
		
			<li><a href="../../symbols/Settings.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">Settings</span></span></a></li>
		
			<li><a href="../../symbols/State.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">State</span></span></a></li>
		
			<li><a href="../../symbols/StorageLocal.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-class"></i><span class="jsdoc-class-index">StorageLocal</span></span></a></li>
		
			<li><a href="../../symbols/String.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-namespace"></i><span class="jsdoc-class-index">String</span></span></a></li>
		
			<li><a href="../../symbols/_global_.html"><span class="indent" style="padding-left:0px;"><i class="icon-jsdoc icon-jsdoc-namespace"></i><span class="jsdoc-class-index">_global_</span></span></a></li>
		
	</ul>
</div>

			<!-- end publish.classesIndex -->
		</div>

		<div id="content" class="span9">
<!-- ============================== source code ============================ -->

			<pre id="source-code" class="prettyprint linenums">/**
 * @preserve Copyright 2012 Martijn van de Rijdt &amp; Modilabs 
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*jslint browser:true, devel:true, jquery:true, smarttabs:true*//*global gui, Form, StorageLocal, Connection, Modernizr, getGetVariable, vkbeautify*/
var /** @type {Connection} */connection;
var /** @type {StorageLocal} */store;
var /** @type {Settings}*/settings;

window.addEventListener("load",function() {
	// Set a timeout...
	setTimeout(function(){
		// Hide the address bar!
		window.scrollTo(0, 1);
	}, 0);
});

$(document).ready(function(){
	"use strict";
	var url;

	connection = new Connection();
	store = new StorageLocal();

	$('[title]').tooltip();

	gui.setup();

	/*** TEMPORARY FIX? https://github.com/twitter/bootstrap/issues/4550 ***/
	$('body').on('touchstart.dropdown', '.dropdown-menu', function (e) { e.stopPropagation(); });
	/*********************/

	$('.url-helper a')
		.click(function(){
			var helper, placeholder, value;
			$(this).parent().addClass('active').siblings().removeClass('active');
			helper = $(this).attr('data-value');
			placeholder = (helper === 'formhub' || helper === 'formhub_uni') ? 'enter formhub account' :
				(helper === 'appspot') ? 'enter appspot subdomain' : 'e.g. formhub.org/johndoe';
			value = (helper === 'formhub_uni') ? 'formhub_u' : '';
			
			$('input#server').attr('placeholder', placeholder);
			if ( $('input#server').val() !== value ){
				$('input#server').val(value).trigger('change');
			}
		})
		.andSelf().find('[data-value="formhub"]').click();

	$('input').change(function(){
		if ($(this).val().length &gt; 0){
			$('.go').click();
		}
		return false;
	});

	$('.go').click(function(){
		var props,
			frag = $('input#server').val(),
			type = $('.url-helper li.active &gt; a').attr('data-value');
		if ($('progress').css('display') === 'none'){
			props = {
				server: connection.oRosaHelper.fragToServerURL(type, frag),
				helper: $('.url-helper li.active &gt; a').attr('data-value'),
				inputValue: $('input#server').val()
			};
			if (props.server){
				$('progress').show();
				connection.getFormlist(props.server, {
					success: function(resp, msg){
						processFormlistResponse(resp, msg, props);
					}
				});
			}
		}
	});

	$('#form-list').on('click', 'a', function(){
		console.log('caught click');
		var server, id,
			href = $(this).attr('href');
			
		//request a url first by launching this in enketo
		if ( !href || href === "" || href==="#" ){
			console.log('going to request enketo url');
			server = $(this).attr('data-server');
			id = $(this).attr('id');
			connection.getSurveyURL(server, id, {
				success: function(resp, msg){
					resp.serverURL = server;
					resp.formId = id;
					processSurveyURLResponse(resp, msg);
				}
			});
		}
		else{
			location.href=href;
		}
		return false;
	});

	loadPreviousState();
});

function loadPreviousState(){
	var i, list,
		server = store.getRecord('__current_server');
	if (server){
		$('.url-helper li').removeClass('active').find('[data-value="'+server.helper+'"]').parent('li').addClass('active');
		$('input#server').val(server.inputValue);
		list = store.getRecord('__server_'+server.url);
		gui.parseFormlist(list, $('#form-list'));
	}
}

function processFormlistResponse(resp, msg, props){
	var helper, inputValue;
	console.log('processing formlist response');
	if (typeof resp === 'object' &amp;&amp; !$.isEmptyObject(resp)){
		store.setRecord('__server_' + props.server, resp, false, true);
		store.setRecord('__current_server', {'url': props.server, 'helper': props.helper, 'inputValue': props.inputValue}, false, true);
	}
	$('progress').hide();
	gui.parseFormlist(resp, $('#form-list'));
}

/**
 * Adds urls to links
 * @param  {?Object.&lt;string, string&gt;} resp [description]
 * @param  {string} msg  [description]
 */
function processSurveyURLResponse(resp, msg){
	var record,
		url = resp.url || null,
		server = resp.serverURL || null,
		id = resp.formId || null;
	console.debug(resp);
	console.debug('processing link to:  '+url);
	if (url &amp;&amp; server &amp;&amp; id){
		record = store.getRecord('__server_'+server) || {};
		record[id]['url'] = url;
		store.setRecord('__server_'+server, record, false, true);
		$('a[id="'+id+'"][data-server="'+server+'"]').attr('href', url).click();
	}
	else{
		//TODO: add error handling
	}
}</pre>
		</div>
	</div>

<!-- ============================== footer ================================= -->
	<footer class="footer">
		
		<p>Documentation generated by <a href="http://code.google.com/p/jsdoc-toolkit/" target="_blankt">JsDoc Toolkit</a> 2.4.0 on Fri Dec 07 2012 17:49:17 GMT-0700 (MST)</p>
	</footer>
</div>
<script type="text/javascript">
	prettyPrint();
	var i = 1;
	$('#source-code li').each(function() {
		$(this).attr({ id: 'line' + (i++) });
	});
</script>
</body>
</html>
