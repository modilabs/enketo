String.prototype.pad=function(a){for(var c=this;c.length<a;)c="0"+c;return c};var profilerRecords=[],xpathEvalNum=0,xpathEvalTime=0,xpathEvalTimePure=0;function Profiler(a){var c=(new Date).getTime();this.report=function(b){b=b||"time taken for "+a+" to execute in milliseconds: "+((new Date).getTime()-c);profilerRecords.push(b)}}
function divideIntoBatches(a,c){var b,d,e,f=[],g=[];for(b=0;b<a.length;b++)f.push({index:b,size:a[b]});for(;0<f.length;){e=[f[0].index];d=f[0].size;if(f[0].size<c)for(b=1;b<f.length;b++)d+f[b].size<c&&(e.push(f[b].index),d+=f[b].size);g.push(e);for(b=0;b<f.length;b++)for(d=0;d<e.length;d++)f[b].index===e[d]&&f.splice(b,1)}return g}var helper=new Helper;
function Helper(){this.setSettings=function(){var a,c,b=[{q:"return",s:"returnURL"},{q:"showbranch",s:"showBranch"},{q:"debug",s:"debug"},{q:"touch",s:"touch"},{q:"server",s:"serverURL"},{q:"form",s:"formURL"},{q:"id",s:"formId"},{q:"formName",s:"formId"},{q:"instanceId",s:"instanceId"},{q:"entityId",s:"entityId"}];for(a=0;a<b.length;a++)c=this.getQueryParam(b[a].q),settings[b[a].s]=null!==c?c:"undefined"!==typeof settings[b[a].s]?settings[b[a].s]:null};this.getQueryParam=function(a){var c=this.getAllQueryParams(),
b;for(b in c)if(b.toLowerCase()===a.toLowerCase())return c[b];return null};this.getAllQueryParams=function(){for(var a,c=window.location.search.substring(1).split("&"),b={},d=0;d<c.length;d++){var e=c[d].split("=");0<e[0].length&&(a=encodeURI(e[1]),a="true"===a?!0:"false"===a?!1:a,b[e[0]]=a)}return b}}
window.onload=function(){setTimeout(function(){var a,c,b={};if(window.performance){c=window.performance.timing;c=c.loadEventEnd-c.responseEnd;"undefined"!==typeof settings&&settings.debug&&(a=(a=window.localStorage.getItem("__loadLog"))?JSON.parse(a):[],a.push(c),10<a.length&&a.shift(),window.localStorage.setItem("__loadLog",JSON.stringify(a)));profilerRecords.push("total loading time: "+c+" milliseconds");for(var d in window.performance.timing)b[d]=window.performance.timing[d];window.opener&&(window.performance&&
window.postMessage)&&window.opener.postMessage(JSON.stringify(b),"*");$(profilerRecords).each(function(a,b){console.log(b)})}},0)};
(function(a){a.fn.getXPath=function(a){for(var b=this.first(),d=[b.prop("nodeName")],b=b.parent(),e=b.prop("nodeName");1==b.length&&e!==a&&"#document"!==e;)d.push(e),b=b.parent(),e=b.prop("nodeName");return"/"+d.reverse().join("/")};a.fn.toLargestWidth=function(c){var b=0,c=c||0;return this.each(function(){a(this).width()>b&&(b=a(this).width())}).each(function(){a(this).width(b+c)})};a.fn.toSmallestWidth=function(){var c=2E3;return this.each(function(){a(this).width()<c&&(c=a(this).width())}).each(function(){a(this).width(c)})};
a.fn.reverse=[].reverse;a.fn.alphanumeric=function(c){c=a.extend({ichars:"!@#$%^&*()+=[]\\';,/{}|\":<>?~`.- ",nchars:"",allow:""},c);return this.each(function(){c.nocaps&&(c.nchars+="ABCDEFGHIJKLMNOPQRSTUVWXYZ");c.allcaps&&(c.nchars+="abcdefghijklmnopqrstuvwxyz");for(var b=c.allow.split(""),d=0;d<b.length;d++)-1!=c.ichars.indexOf(b[d])&&(b[d]="\\"+b[d]);c.allow=b.join("|");var e=c.ichars+c.nchars,e=e.replace(RegExp(c.allow,"gi"),"");a(this).keypress(function(a){var b;b=a.charCode?String.fromCharCode(a.charCode):
String.fromCharCode(a.which);e.indexOf(b)!=-1&&a.preventDefault();a.ctrlKey&&b=="v"&&a.preventDefault()});a(this).bind("contextmenu",function(){return false})})};a.fn.numeric=function(c){var b="abcdefghijklmnopqrstuvwxyz",b=b+b.toUpperCase(),c=a.extend({nchars:b},c);return this.each(function(){a(this).alphanumeric(c)})};a.fn.alpha=function(c){c=a.extend({nchars:"1234567890"},c);return this.each(function(){a(this).alphanumeric(c)})};a.fn.btnBusyState=function(c){var b,d;return this.each(function(){b=
a(this);d=b.data("btnContent");console.log("busy ",c);console.log("btnContent",d);c&&!d?(d=b.html(),b.data("btnContent",d),b.empty().append("<progress></progress>").attr("disabled",!0)):!c&&d&&(b.data("btnContent",null),b.empty().append(d).removeAttr("disabled"))})};a.fn.capitalizeStart=function(a){a||(a=1);var b=this.contents().filter(function(){return 3==this.nodeType}).first(),d=b.text(),a=d.split(" ",a).join(" ");b.length&&(b[0].nodeValue=d.slice(a.length),b.before('<span class="capitalize">'+
a+"</span>"))}})(jQuery);/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var gui,printO;$(document).ready(function(){helper.setSettings();gui=new GUI;gui.init();"undefined"==typeof console&&(console={log:function(){}});"undefined"==typeof window.console.debug&&(console.debug=console.log);settings.debug||(window.console.log=function(){},window.console.debug=function(){});settings.touch?(Modernizr.touch=!0,$("html").addClass("touch")):!1===settings.touch&&(Modernizr.touch=!1,$("html").removeClass("touch"));printO=new Print});
function GUI(){this.supportLink='<a href="mailto:'+settings.supportEmail+'">'+settings.supportEmail+"</a>"}GUI.prototype.init=function(){this.nav.setup();this.pages.init();this.setEventHandlers();"function"===typeof this.setCustomEventHandlers&&this.setCustomEventHandlers();$("footer").detach().appendTo("#container");this.positionPageAndBar()};GUI.prototype.setup=function(){$(window).trigger("resize")};
GUI.prototype.setEventHandlers=function(){var a=this;$(document).on("click","#feedback-bar .close",function(){a.feedbackBar.hide();return!1});$(document).on("click",".touch #feedback-bar",function(){a.feedbackBar.hide()});$(document).on("click","#page .close",function(){a.pages.close();return!1});$("button.print").on("click",function(){printO.printForm()});$(document).on("click",'a[href^="#"]:not([href="#"]):not(nav ul li a)',function(a){var b=$(this).attr("href");console.log("captured click to nav page, href="+
b);"#"!==b&&(a.preventDefault(),$('nav li a[href="'+b+'"]').click())});$('nav ul li a[href^="#"]').click(function(c){c.preventDefault();c=$(this).attr("href").substr(1);a.pages.open(c);$(this).closest("li").addClass("active").siblings().removeClass("active")});$(window).on("onlinestatuschange",function(c,b){a.updateStatus.connection(b)});$(document).on("edit","form.jr",function(c,b){a.updateStatus.edit(b)});$(document).on("browsersupport",function(c,b){a.updateStatus.support(b)});$("#page, #feedback-bar").on("change",
function(){a.positionPageAndBar()});$(document).on("xpatherror",function(c,b){var d=settings.supportEmail;a.alert('A formula evaluation error occurred. Please contact <a href="mailto:'+d+"?subject=xpath errors for: "+location.href+"&body="+b+'" target="_blank" >'+d+'</a> with this error:<ul class="error-list"><li>'+b+"</li></ul>","Formula Error")})};
GUI.prototype.nav={setup:function(){$("article.page").each(function(){var a,c="",b;b=$(this).attr("id");a=$(this).attr("data-display-icon")?'<img src="/images/'+$(this).attr("data-display-icon")+'" alt="menu-icon" />':$(this).attr("data-display")?$(this).attr("data-display"):b;c=$(this).attr("data-title")?$(this).attr("data-title"):b;b=$(this).attr("data-ext-link")?$(this).attr("data-ext-link"):"#"+b;$('<li class=""><a href="'+b+'" title="'+c+'" >'+a+"</a></li>").appendTo($("nav ul"))})},reset:function(){$("nav ul li").removeClass("active")}};
GUI.prototype.pages={init:function(){this.$pages=$("<pages></pages>");$("article.page").detach().appendTo(this.$pages)},get:function(a){var c=this.$pages.find('article[id="'+a+'"]');return c=0<c.length?c:$('article[id="'+a+'"]')},isShowing:function(a){return 0<$("#page article.page"+("undefined"!==typeof a?'[id="'+a+'"]':"")).length},open:function(a){$("header");var c=this;this.isShowing(a)||(a=this.get(a),1!==a.length?console.error("page not found"):(this.isShowing()&&this.close(),$("#page .content").prepend(a.show()).trigger("change"),
$("#page").show(),$(".main").css("opacity","0.3"),$(window).on("resize.pageEvents",function(){$("#page").trigger("change")}),setTimeout(function(){$(window).on("click.pageEvents",function(a){console.log($(a.target).prop("nodeName"));0===$(a.target).parents(".btn-toolbar, label, fieldset").length&&c.close();return!0})},1E3)))},close:function(){var a=0<$("#page .page").length?$("#page .page").detach():[];0<a.length&&(this.$pages.append(a),$("#page").trigger("change"),$("nav ul li").removeClass("active"),
$(window).off(".pageEvents"));$(".main").css("opacity","1")}};GUI.prototype.feedbackBar={show:function(a,c){var b,c=c?1E3*c:1E4;$("#feedback-bar p").eq(1).remove();$("#feedback-bar p").html()!==a&&(b=$("<p></p>"),b.append(a),$("#feedback-bar").append(b));$("#feedback-bar").show().trigger("change");setTimeout(function(){typeof b!=="undefined"&&b.remove();$("#feedback-bar").trigger("change")},c)},hide:function(){$("#feedback-bar p").remove();$("#feedback-bar").trigger("change")}};
GUI.prototype.feedback=function(a,c,b,d){b=b||"Information";Modernizr.touch?d?this.confirm({msg:a,heading:b},d,c):this.alert(a,b,"info",c):this.feedbackBar.show(a,c)};
GUI.prototype.alert=function(a,c,b,d){var e,f=$("#dialog-alert"),b=b||"error",b="normal"===b?"":"alert alert-block alert-"+b;f.find(".modal-header h3").text(c||"Alert");f.find(".modal-body p").removeClass().addClass(b).html(a).capitalizeStart();f.modal({keyboard:!0,show:!0});f.on("hidden",function(){f.find(".modal-header h3, .modal-body p").html("");clearInterval(e)});if("number"===typeof d){var g=d.toString();f.find(".self-destruct-timer").text(g);e=setInterval(function(){g--;f.find(".self-destruct-timer").text(g)},
1E3);setTimeout(function(){clearInterval(e);f.find(".close").click()},1E3*d)}};
GUI.prototype.confirm=function(a,c,b){var d,e,f,g,h;"string"===typeof a?d=a:"string"===typeof a.msg&&(d=a.msg);d="undefined"!==typeof d?d:"Please confirm action";e="undefined"!==typeof a.heading?a.heading:"Are you sure?";f="undefined"!==typeof a.errorMsg?a.errorMsg:"";a="undefined"!==typeof a.dialog?a.dialog:"confirm";c="undefined"!==typeof c?c:{};c.posButton=c.posButton||"Confirm";c.negButton=c.negButton||"Cancel";c.posAction=c.posAction||function(){return false};c.negAction=c.negAction||function(){return false};
c.beforeAction=c.beforeAction||function(){};g=$("#dialog-"+a);g.find(".modal-header h3").text(e);g.find(".modal-body .msg").html(d).capitalizeStart();g.find(".modal-body .alert-error").html(f).show();f||g.find(".modal-body .alert-error").hide();g.modal({keyboard:!0,show:!0});g.on("shown",function(){c.beforeAction.call()});g.find("button.positive").on("click",function(){c.posAction.call();g.modal("hide")}).text(c.posButton);g.find("button.negative").on("click",function(){c.negAction.call();g.modal("hide")}).text(c.negButton);
g.on("hide",function(){g.off("shown hidden hide");g.find("button.positive, button.negative").off("click")});g.on("hidden",function(){g.find(".modal-body .msg, .modal-body .alert-error, button").text("")});if("number"===typeof b){var i=b.toString();g.find(".self-destruct-timer").text(i);h=setInterval(function(){i--;g.find(".self-destruct-timer").text(i)},1E3);setTimeout(function(){clearInterval(h);g.find(".close").click()},1E3*b)}};
GUI.prototype.confirmLogin=function(a,c){c=c||settings.serverURL;gui.confirm({msg:a||"<p>In order to submit your queued data, you need to login. If you want to do this now, you will be redirected, and loose unsaved information.</p><p>Would you like to login now or later?</p>",heading:"Login Required"},{posButton:"Log in now",negButton:"Later",posAction:function(){var a="?server="+encodeURIComponent(c)+"&return="+encodeURIComponent(location.href),a=a+(settings.formId?"&id="+settings.formId:""),a=a+
(settings.touch?"&touch="+settings.touch:""),a=a+(settings.debug?"&debug="+settings.debug:"");location.href=location.protocol+"//"+location.host+"/authenticate"+a},negAction:function(){console.log("login cancelled")},beforeAction:function(){}})};
GUI.prototype.showLoadErrors=function(a,c){var b='<ul class="error-list"><li>'+a.join("</li><li>")+"</li></ul",d="* "+a.join("* "),e=1<a.length?"s":"",f=settings.supportEmail;this.alert("<p>Error"+e+" occured during the loading of this form. "+(c||"")+'</p><br/><p>Please contact <a href="mailto:'+f+"?subject=loading errors for: "+location.href+"&body="+d+'" target="_blank" >'+f+"</a> with the link to this page and the error message"+e+" below:</p>"+b,"Loading Error"+e)};
GUI.prototype.updateStatus={connection:function(){},edit:function(a){a?$("header #status-editing").removeClass().addClass("ui-icon ui-icon-pencil").attr("title","Form is being edited."):$("header #status-editing").removeClass().attr("title","")},support:function(){},offlineLaunch:function(a){$(".drawer #status-offline-launch").text(a?"Offline Launch: Yes":"Offline Launch: No")}};
GUI.prototype.fillHeight=function(a){var c=$(window).height(),b=$("header").outerHeight(!0),a=a.outerHeight()-a.height();return c-b-a};
GUI.prototype.positionPageAndBar=function(){console.log("positionPageAndBar called");var a,c;a=$("header");c=a.outerHeight()||0;var b=$("#feedback-bar"),d=0<b.find("p").length?!0:!1,e=b.outerHeight(),f=$("#page"),g=this.pages.isShowing(),h=f.outerHeight();f.css({position:a.css("position")});if(0<a.length&&"fixed"!==a.css("position"))return d||b.hide(),g||f.hide(),!1;a=!d?0-e:c;c=!g?0-h:d?a+e:c;b.css("top",a);f.css("top",c)};
GUI.prototype.setSettings=function(a){var c,b=this;console.log("gui updateSettings() started");$.each(a,function(a,e){c=e?b.pages.get("settings").find('input[name="'+a+'"][value="'+e+'"]'):b.pages.get("settings").find('input[name="'+a+'"]');0<c.length&&c.attr("checked",e?!0:!1).trigger("change")})};
GUI.prototype.parseFormlist=function(a,c,b){var d,e="";console.log("list: ",a);if($.isEmptyObject(a))c.addClass("empty"),b||(e='<p class="alert alert-error">Error occurred during creation of form list or no forms found</p>');else{for(d in a)e+='<li><a class="btn btn-block btn-info" id="'+d+'" title="'+a[d].title+'" href="'+a[d].url+'" data-server="'+a[d].server+'" >'+a[d].name+"</a></li>";c.removeClass("empty")}c.find("ul").empty().append(e)};function Print(){this.setStyleSheet();this.setDpi()}
Print.prototype.setDpi=function(){var a,c=document.body.appendChild(document.createElement("DIV"));c.style.width="1in";c.style.padding="0";a=c.offsetWidth;c.parentNode.removeChild(c);this.dpi=a};Print.prototype.setStyleSheet=function(){this.styleSheet=this.getStyleSheet();this.$styleSheetLink=$('link[media="print"]:eq(0)')};Print.prototype.getStyleSheet=function(){for(var a=0;a<document.styleSheets.length;a++)if("print"===document.styleSheets[a].media.mediaText)return document.styleSheets[a];return null};
Print.prototype.styleToAll=function(){this.styleSheet||this.setStyleSheet();this.styleSheet.media.mediaText="all";this.$styleSheetLink.attr("media","all")};Print.prototype.styleReset=function(){this.styleSheet.media.mediaText="print";this.$styleSheetLink.attr("media","print")};Print.prototype.printForm=function(){this.removePageBreaks();this.removePossiblePageBreaks();this.styleToAll();this.addPageBreaks();this.styleReset();window.print()};Print.prototype.removePageBreaks=function(){$(".page-break").remove()};
Print.prototype.removePossiblePageBreaks=function(){$(".possible-break").remove()};
Print.prototype.addPossiblePageBreaks=function(){var a=$("<hr>",{"class":"possible-break"});this.removePossiblePageBreaks();$("form.jr").before(a.clone()).after(a.clone()).find("fieldset>legend, label:not(.geo)>input:not(input:radio, input:checkbox), label>select, label>textarea, .trigger>*, h4>*, h3>*, .jr-appearance-field-list>*").parent().each(function(){var c,b;c=$(this);return(b=c.prev().get(0))&&("H3"===b.nodeName||"H4"===b.nodeName)||$(b).hasClass("repeat-number")||0<c.parents("#jr-calculated-items, #jr-preload-items").length||
0<c.parents(".jr-appearance-field-list").length?null:c.before(a.clone())});$(".possible-break").each(function(){if($(this).prev().hasClass("possible-break"))return $(this).remove()})};
Print.prototype.addPageBreaks=function(){var a,c,b,d,e,f,g,h;g=9.5*this.dpi;d=function(a,b){this.begin=$(a);this.begin_top=this.begin.offset().top;this.end=$(b);this.end_top=this.end.offset().top;this.h=this.end_top-this.begin_top;if(0>this.h)throw console.debug("begin (top: "+this.begin_top+")",a),console.debug("end (top: "+this.end_top+")",b),Error("A question group has an invalid height.");};d.prototype.break_before=function(){var a,b;b=(a=this.begin.prev().get(0))?["after",a]:["before",this.begin.parent().get(0)];
a=b[0];return $(b[1])[a]("<hr class='page-break' />")};this.removePageBreaks();this.addPossiblePageBreaks();b=$(".possible-break");c=[];for(a=1;a<b.length;a++)c.push(new d(b[a-1],b[a]));d=0;b=[];a=[];f=0;for(h=c.length;f<h;f++)e=c[f],d+e.h>g?(a.push(b),b=[e],d=e.h):(b.push(e),d+=e.h);a.push(b);console.debug("pages: ",a);g=1;for(b=a.length;g<b;g++)c=a[g],0<c.length&&c[0].break_before();return $(".possible-break").remove()};/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function Connection(){var a=this;this.CONNECTION_URL="/checkforconnection.php";this.SUBMISSION_URL="/data/submission";this.GETSURVEYURL_URL="/launch/get_survey_url";this.uploadOngoingBatchIndex=this.uploadOngoingID=this.currentOnlineStatus=null;this.uploadResult={win:[],fail:[]};this.uploadQueue=[];this.oRosaHelper=new this.ORosaHelper(this);this.init=function(){this.checkOnlineStatus();a=this;window.setInterval(function(){a.checkOnlineStatus()},15E3);$(window).on("offline online",function(){console.log("window network event detected");
a.setOnlineStatus(a.getOnlineStatus())});$(window).trigger("online")}}Connection.prototype.checkOnlineStatus=function(){var a,c=this;navigator.onLine?this.uploadOngoingID||$.ajax({type:"GET",url:this.CONNECTION_URL,cache:!1,dataType:"json",timeout:3E3,complete:function(b){a="undefined"!==typeof b.responseText&&"connected"===b.responseText;c.setOnlineStatus(a)}}):this.setOnlineStatus(!1)};Connection.prototype.getOnlineStatus=function(){return this.currentOnlineStatus};
Connection.prototype.setOnlineStatus=function(a){a!==this.currentOnlineStatus&&(console.log("online status changed to: "+a+", triggering window.onlinestatuschange"),$(window).trigger("onlinestatuschange",a));this.currentOnlineStatus=a};Connection.prototype.cancelSubmissionProcess=function(){this.uploadOngoingBatchIndex=this.uploadOngoingID=null;this.uploadResult={win:[],fail:[]};this.uploadQueue=[]};
Connection.prototype.uploadRecords=function(a,c,b){var d,e,f,c=c||!1,b=b||null;if(!a.name||!a.instanceID||!a.formData||!a.batches||"undefined"==typeof a.batchIndex)return!1;d=$.grep(this.uploadQueue,function(b){return a.instanceID===b.instanceID&&a.batchIndex===b.batchIndex});e=$.grep(this.uploadResult.win,function(b){return a.instanceID===b.instanceID&&a.batchIndex===b.batchIndex});f=this.uploadOngoingID===a.instanceID&&this.uploadOngoingBatchIndex===a.batchIndex;0===d.length&&0===e.length&&!f?(a.forced=
c,this.uploadQueue.push(a),this.uploadOngoingID||(this.uploadResult={win:[],fail:[]},this.uploadBatchesResult={},this.uploadOne(b))):d.forced=c;return!0};
Connection.prototype.uploadOne=function(a){var c,b,d=this,a="undefined"===typeof a||!a?{complete:function(a){$(document).trigger("submissioncomplete");d.processOpenRosaResponse(a.status,{name:c.name,instanceID:c.instanceID,batches:c.batches,batchIndex:c.batchIndex,forced:c.forced});d.uploadOne()},error:function(a,b){"timeout"===b?console.debug("submission request timed out"):console.error("error during submission, textStatus:",b)},success:function(){}}:a;0<this.uploadQueue.length&&(c=this.uploadQueue.pop(),
!1===this.currentOnlineStatus?this.processOpenRosaResponse(0,c):(this.uploadOngoingID=c.instanceID,this.uploadOngoingBatchIndex=c.batchIndex,b=c.formData,b.append("Date",(new Date).toUTCString()),console.debug("prepared to send: ",b),this.setOnlineStatus(null),$(document).trigger("submissionstart"),$.ajax(this.SUBMISSION_URL,{type:"POST",data:b,cache:!1,contentType:!1,processData:!1,timeout:3E5,complete:function(b,c){d.uploadOngoingID=null;d.uploadOngoingBatchIndex=null;a.complete(b,c)},error:a.error,
success:a.success})))};
Connection.prototype.processOpenRosaResponse=function(a,c){var b,d,e,f="";e=[];b="Contact "+settings.supportEmail+" please.";var g="Sorry, the enketo or formhub server is down. Please try again later or contact "+settings.supportEmail+" please.";b={"0":{success:!1,msg:"undefined"!==typeof jrDataStrToEdit?"Uploading of data failed. Please try again.":"Uploading of data failed (maybe offline) and will be tried again later."},200:{success:!1,msg:"Data server did not accept data. "+b},201:{success:!0,
msg:""},202:{success:!0,msg:""},"2xx":{success:!1,msg:"Unknown error occurred when submitting data. "+b},400:{success:!1,msg:"Data server did not accept data. Contact the survey administrator please."},403:{success:!1,msg:"You are not allowed to post data to this data server. Contact the survey administrator please."},404:{success:!1,msg:"Submission service on data server not found or not properly configured."},"4xx":{success:!1,msg:"Unknown submission problem on data server."},413:{success:!1,msg:"Data is too large. Please contact "+
settings.supportEmail+"."},500:{success:!1,msg:g},503:{success:!1,msg:g},"5xx":{success:!1,msg:g}};console.debug("submission results with status: "+a+" for ",c);c.batchText=1<c.batches?" (batch #"+(c.batchIndex+1)+" out of "+c.batches+")":"";if("undefined"!==typeof b[a])if(c.msg=b[a].msg,!0===b[a].success){if(1<c.batches){"undefined"==typeof this.uploadBatchesResult[c.instanceID]&&(this.uploadBatchesResult[c.instanceID]=[]);this.uploadBatchesResult[c.instanceID].push(c.batchIndex);for(b=0;b<c.batches;b++)-1===
$.inArray(b,this.uploadBatchesResult[c.instanceID])&&(d=!0)}d?console.debug("not all batches for instanceID have been submitted, current queue:",this.uploadQueue):$(document).trigger("submissionsuccess",[c.name,c.instanceID]);this.uploadResult.win.push(c)}else!1===b[a].success&&this.uploadResult.fail.push(c);else 401==a?(this.cancelSubmissionProcess(),gui.confirmLogin()):500<a?(console.error("Error during uploading, received unexpected statuscode: "+a),c.msg=b["5xx"].msg,this.uploadResult.fail.push(c)):
400<a?(console.error("Error during uploading, received unexpected statuscode: "+a),c.msg=b["4xx"].msg,this.uploadResult.fail.push(c)):200<a&&(console.error("Error during uploading, received unexpected statuscode: "+a),c.msg=b["2xx"].msg,this.uploadResult.fail.push(c));if(!(0<this.uploadQueue.length)){console.debug("online: "+this.currentOnlineStatus,this.uploadResult);if(0<this.uploadResult.win.length){for(b=0;b<this.uploadResult.win.length;b++)d=this.uploadResult.win[b].name,-1===$.inArray(d,e)&&
(e.push(d),f="undefined"!==typeof this.uploadResult.win[b].msg?f+this.uploadResult.win[b].msg+" ":"");d=1<e.length?" were":" was";e=e.join(", ");gui.feedback(e.substring(0,e.length)+d+" successfully uploaded. "+f);this.setOnlineStatus(!0)}if(0<this.uploadResult.fail.length){f="";if(!1!==this.currentOnlineStatus){for(b=0;b<this.uploadResult.fail.length;b++)this.uploadResult.fail[b].forced&&(f+=this.uploadResult.fail[b].name+this.uploadResult.fail[b].batchText+": "+this.uploadResult.fail[b].msg+"<br />");
f&&gui.alert(f,"Failed data submission")}this.setOnlineStatus(!1)}}};Connection.prototype.maxSubmissionSize=function(){var a,c=this;return"undefined"==typeof this.maxSize&&!this.maxSize?($.ajax("/data/max_size",{type:"GET",async:!1,timeout:5E3,success:function(b){a=parseInt(b,10)||5E6;a=104857600<a?104857600:a;c.maxSize=a},error:function(){a=5E6}}),a):this.maxSize};Connection.prototype.isValidURL=function(a){return/^(https?:\/\/)(([\da-z\.\-]+)\.([a-z\.]{2,6})|(([0-9]{1,3}\.){3}[0-9]{1,3}))([\/\w \.\-]*)*\/?[\/\w \.\-\=\&\?]*$/.test(a)};
Connection.prototype.getFormlist=function(a,c){c=this.getCallbacks(c);this.isValidURL(a)?$.ajax("/forms/get_list",{type:"GET",data:{server_url:a},cache:!1,contentType:"json",timeout:6E4,success:c.success,error:c.error,complete:c.complete}):c.error(null,"validationerror","not a valid URL")};
Connection.prototype.getSurveyURL=function(a,c,b){b=this.getCallbacks(b);!a||!this.isValidURL(a)?b.error(null,"validationerror","not a valid server URL"):!c||0===c.length?b.error(null,"validationerror","not a valid formId"):$.ajax({url:this.GETSURVEYURL_URL,type:"POST",data:{server_url:a,form_id:c},cache:!1,timeout:6E4,dataType:"json",success:b.success,error:b.error,complete:b.complete})};
Connection.prototype.getTransForm=function(a,c,b,d,e){var f=new FormData,e=this.getCallbacks(e),a=a||null,c=c||null,d=d||null,b=b||new Blob;0===b.size&&(!a||!c)&&!d?e.error(null,"validationerror","No form file or URLs provided"):0===b.size&&!this.isValidURL(a)&&!this.isValidURL(d)?e.error(null,"validationerror","Not a valid server or form url"):0===b.size&&!d&&(!c||0===c.length)?e.error(null,"validationerror","No form id provided"):(a&&f.append("server_url",a),c&&f.append("form_id",c),d&&f.append("form_url",
d),b&&f.append("xml_file",b),console.debug("form file: ",b),$.ajax("/transform/get_html_form",{type:"POST",cache:!1,contentType:!1,processData:!1,dataType:"xml",data:f,success:e.success,error:e.error,complete:e.complete}))};Connection.prototype.validateHTML=function(a,c){var b=new FormData,c=this.getCallbacks(c);b.append("level","error");b.append("content",a);$.ajax("/html5validate/",{type:"POST",data:b,contentType:!1,processData:!1,success:c.success,error:c.error,complete:c.complete})};
Connection.prototype.ORosaHelper=function(a){this.fragToServerURL=function(c,b){var d;d="";if(!b)return console.log("nothing to do"),null;console.debug("frag: "+b);if(a.isValidURL(b))return b;switch(c){case "http":case "https":d=/^http(|s):\/\//.test(b)?"":c+"://";d+=b;break;case "formhub_uni":case "formhub":d="https://formhub.org/"+b;break;case "appspot":d="https://"+b+".appspot.com"}if(!a.isValidURL(d))return console.error("not a valid url: "+d),null;console.log("server_url: "+d);return d}};
Connection.prototype.getNumberFormsLaunched=function(a){a=this.getCallbacks(a);$.ajax({url:"/front/get_number_launched_everywhere",dataType:"json",success:a.success,error:a.error,complete:a.complete})};Connection.prototype.loadGoogleMaps=function(a){var c=settings.mapsDynamicAPIKey||"",b=document.createElement("script");window.googleMapsInit=a;b.type="text/javascript";b.src="https://maps.googleapis.com/maps/api/js?v=3.exp&key="+c+"&sensor=false&libraries=places&callback=googleMapsInit";document.body.appendChild(b)};
Connection.prototype.getCallbacks=function(a){a=a||{};a.error=a.error||function(a,b,d){console.error(b+" : "+d)};a.complete=a.complete||function(){};a.success=a.success||function(){console.log("success!")};return a};/*
 Copyright 2012 Martijn van de Rijdt

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
$(document).ready(function(){var a=new Connection;$(".update-forms-total").click(function(c){c.preventDefault();console.log("updating number of launched forms");a.getNumberFormsLaunched({success:function(a){"object"===typeof a&&(a.total&&0<a.total)&&$(".counter").text(a.total)}})}).click();$(document).on("click",'a[href^="#"]:not([href="#"])',function(){window.location.hash=$(this).attr("href")})});